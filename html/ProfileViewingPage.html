<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Viewing Page</title>
</head>
<body>

    <input type = "hidden" id = 'hidden_token'>
    <!-- This is the container of the user section! Will have all elements stored in it.-->
    <div id = "UserBiographyContainer"> 
        <div id = "ProfilePicContainer"> 
            <img id = "ProfilePic">
        </div>
        <h2 id="userBioHeader">User Biography</h2>
        <textarea name="userBio" id="biography" rows="15" cols="130"></textarea>
        <button id="saveButton" onclick="saveBiographyToServer()">Save</button>

        <!-- This is the 3 dot!!! -->
        <div id = "threeDotsContainer">
        
            <!-- 3 dot drop down menu -->
            <div class = "dropdown">
                <button class = "dropbtn"> <img id = "threeDots" src = "png-transparent-three-dots-multimedia-solid-px-icon-thumbnail.png"> </button>

                <div class = "dropdown-content">
                    <a href= "#"> Add As A Friend</a>
                    <a href = "#"> Unfriend </a>
                    <a href = "#"> Block </a>
                </div>
            </div>
            <!--End of drop down menu-->
        </div>
        
        <h2 id = "userName"> Username </h2>
        
    </div>
    </input>


    <br>


    <div id = "Fav1Container"> <h1> Favorite Artists </h1> </div>

    <br>

    <div style="overflow: auto; overflow-x: auto;" id="scrollContainer1">

    </div>


    <div id = "Fav2Container"> <h1> Top Tracks </h1></div>


    <div style="overflow: auto; overflow-x: auto;" id = "scrollContainer2">

    </div>


    <div id = "Fav3Container"> <h1> Favorite Genres </h1></div>


    <div id = "scrollContainer3">

    </div>

<style type = "text/css">
    #userBioHeader {
        position: relative;
        bottom: 300px;
        left: 350px;
    }
    #biography {
        position: relative;
        bottom: 300px;
        left: 350px;
    }
    #saveButton {
        position: relative;
        bottom: 305px;
        left: 350px;
    }
    #UserBiographyContainer{
        height: 400px;
        width: 1550px;

        background-image: linear-gradient(white, white); 
        
        margin-left: 25px;
        margin-top: 50px;
        position: relative;
    }
    
    
    #ProfilePicContainer{
        height: 300px;
        width: 300px;

        /*background-color: red;*/
        position: relative;

        top: 10px;
        left: 10px;
    }

    #ProfilePic{
        object-fit: cover;
        object-position: center center;

        height: 100%;
        width: 100%;
        border-radius: 50%;
    }
    
    #threeDotsContainer{
        height: 50px;
        width: 50px;

        /*background-color: red;*/
        position: absolute;

        top: 10px;
        right: 10px;
        border-radius: 50%;
    }
    
    #threeDots{
        height: 100%;
        width: 100%;

        border-radius: 50%;
    }
    
    #userBio{
        height: 250px;
        width: 1000px;

        text-align: center;
        font-size: x-large;
        color:black;
        background-color: lightgray;
        padding-top: 50px;
        
        position: absolute;

        left: 30%;
        top: 20px;
    }

    #userName{
        height: 50px;
        width: 200px;

        text-align: center;
        
        background-color: white;
        padding-top: 15px;

        position: absolute;
        left: 55px;
        bottom: 5px;
    }



    #Fav1Container{
        /*display: inline-block;*/
        background-color: white;
        border: 2px solid;
        /*border-color: grey;*/

        width: 300px;
        height: 75px;

        margin-top: 75px;
        position: absolute;
        left: 8%;   
    }
    #Fav2Container{
        /*display: inline-block;*/
        background-color: white;
        border: 2px solid;
        /*border-color: grey;*/

        width: 300px;
        height: 75px;

        margin-top: 75px;
        position: absolute;
        left: 8%; 
    }
    #Fav3Container{
        /*display: inline-block;*/
        background-color: white;
        border: 2px solid;
        /*border-color: grey;*/

        width: 300px;
        height: 75px;

        margin-top: 75px;
        position: absolute;
        left: 8%; 
    }


    







    #scrollContainer1{
        border: none;
        font: 24px/36px sans-serif;
        width: 900px;
        height: 350px;
        overflow-x: auto; /* We only give the vertical scroll wheel*/
        overflow-y: auto;
        background-color: white;
        display: flex;

        margin-top: 210px;
        margin-left: 25px;
        position: relative; 
        bottom: 50px;
    }

    #parent1{
        display: inline-block;
        background-color: green;
        margin-top: 25px;
        margin-left: 25px;
    }
    
    #FavoriteArtists{    
        display: inline-block;
        background-image: linear-gradient(white, white);
        height: 250px;
        width: 500px;
    } 
    


    #scrollContainer2{
        border: none;
        font: 24px/36px sans-serif;
        width: 900px;
        height: 350px;
        overflow-y: scroll; /* We only give the vertical scroll wheel*/
        display: flex;

        background-color: white;

        margin-top: 220px;
        margin-left: 25px;
        position: relative; 
        bottom: 50px;
    }

    #parent2{
        display: inline-block;
        background-color: green;
        margin-top: 25px;
        margin-left: 25px;

        width: 500px
    }
    
    #FavoriteSongs{
        display: inline-block;
        background-image: linear-gradient(white, white); 
        height: 250px;
        width: 100%;
    } 
    

    #scrollContainer3{
        border: none;
        font: 24px/36px sans-serif;
        width: 900px;
        height: 350px;
        overflow-y: scroll; /* We only give the vertical scroll wheel*/

        background-color: white;

        margin-top: 220px;
        margin-left: 25px;
        position: relative; 
        bottom: 50px;
    }

    #parent3{
        display: inline-block;
        background-color: green; 
        margin-top: 25px;
        margin-left: 25px;
    }
    
    #FavoriteGenres{
        display: inline-block;
        background-image: linear-gradient(white, white);
        height: 250px;
        width: 500px;
    } 
    
    


    #title{
        background-color: #1db954;
        width: 100%;
    }
       
    
    #songName{
        background-color: grey; 
        width: 100%;   
        margin-top: 25px; 
    }
    
    tr{
/*        background-color: rgb(9, 177, 82); */
        width: max-content;
    }
    
    td{
        background-color: white;
        width: max-content;
    }
    
    body {
        font-family: arial,sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(to bottom, #17e35f, #191414);
        background-size: cover;
        background-attachment: fixed;
      }
    
    table{
        text-align: center;            
    }
    
    h1{
        color:black;
        text-align: center;
    }




    .droppbtn{
        background-color: white;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
        border-radius: 50%;
    }


    .dropdown-content{
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;

    }

    .dropdown {
        position: relative;
        display: inline-block;
        
    }

    .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
    }

    .dropdown-content a:hover {
        background-color: #ddd;
        
    }

    .dropdown:hover .dropdown-content {
        display: block;
    }

    .dropdown:hover .dropbtn {
        background-color: #3e8e41;
        border-radius: 50%;
    }




    html{
        height: 100%;
        /*background-image: linear-gradient(#07301e,black); */
        background-color: #1DB954;
    }


    #genreTitle{
        height: 10px;
        width: 100px;

        margin-top: 25px;
        position: absolute;
        left: 10px;
    }

    </style>

<script> 
    const storedProfile = localStorage.getItem("profile");
    const profile = JSON.parse(storedProfile);

    const storedFollowedArtist = localStorage.getItem("followedArtists");
    const followedArtists = JSON.parse(storedFollowedArtist);

    const storedTopTracks = localStorage.getItem("topTracks");
    const topTracks = JSON.parse(storedTopTracks);

    displayGenres();
    displayArtists();
    displaySongs();
    populateUserBiography();

    function saveBiographyToServer() {
      var biography = document.getElementById('biography').value;

      // Perform an AJAX request to save the biography in the database
      var xhr = new XMLHttpRequest();
      xhr.open('POST', '../php/SaveProfileToServer.php', true);
      xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
      xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && xhr.status === 200) {
          // Handle the response from the server if needed
          console.log(xhr.responseText);
        }
      };
      xhr.send('userBio=' + biography.toString() +
                '&userId=' + profile.id);
    }

    function populateUserBiography() {
        let xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (this.readyState === 4 && this.status === 200) {

                let userData = JSON.parse(this.responseText);
                if (profile.images[0]) {

                    document.getElementById("biography").value = userData.userBio; 
                }
            }
        };
        xhr.open("GET", "../php/GetProfileFromServer.php?userId=" + profile.id);
        xhr.send();
    }

    function displayGenres(){

        // window.alert("You have genres displaying!");

        for(var i = 0; i < 15; i++){

            // THIS CREATES THE genre titles
            // Get a reference to the scroll container element 
            var scrollContainer3 = document.getElementById("scrollContainer3");

            // Create a new div element
            var genreTitleContainer = document.createElement("div");

            // Set some content for the newDiv. You can substitute values for the defeault values
            genreTitleContainer.innerHTML = "<div id = 'genreTitle' > Country </div> <br> <br>";

            // Add the new div to the container
            scrollContainer3.appendChild(genreTitleContainer);  
        }
    }


    function displayArtists(){

        var scrollContainer1 = document.getElementById("scrollContainer1");

        for(var i = 0; i < 10; i++) {

            var imageUrl = followedArtists.artists.items[i].images[0].url;

            // Create the image element
            var image = document.createElement("img");
            image.src = imageUrl;
            image.style.width = "200px";
            image.style.height = "200px";

            // Create the paragraph element
            var name = document.createElement("p");
            name.textContent = followedArtists.artists.items[i].name;

            // Create the table row and cell
            var row = document.createElement("tr");
            var cell = document.createElement("td");

            // Append the image and paragraph elements to the cell
            cell.appendChild(image);
            cell.appendChild(name);

            // Append the cell to the row
            row.appendChild(cell);

            // Append the row to the container
            scrollContainer1.appendChild(row);

        }

    }

    function displaySongs(){

        var scrollContainer2 = document.getElementById("scrollContainer2");

        for(var i = 0; i < 10; i++) {

            var imageUrl = topTracks.items[i].album.images[0].url
            var previewUrl = topTracks.items[i].preview_url;

            // Create the image element
            var image = document.createElement("img");
            image.src = imageUrl;
            image.style.width = "200px";
            image.style.height = "200px";

            // Create the paragraph element
            var name = document.createElement("p");
            name.textContent = topTracks.items[i].name;

            // Create the table row and cell
            var row = document.createElement("tr");
            var cell = document.createElement("td");

            // Add click event listener to play the track preview
            image.addEventListener('click', function(previewUrl) {
              return function() {
                toggleAudio(previewUrl);
              };
            }(previewUrl));

            // Append the image and paragraph elements to the cell
            cell.appendChild(image);
            cell.appendChild(name);

            // Append the cell to the row
            row.appendChild(cell);

            // Append the row to the container
            scrollContainer2.appendChild(row);

        }

        var audioPlayer = new Audio();

        function toggleAudio(previewUrl) {
          if (audioPlayer.src === previewUrl && !audioPlayer.paused) {
            // If the same preview is already playing, pause it
            audioPlayer.pause();
          } else {
            // Otherwise, set the new preview URL and play it
            audioPlayer.src = previewUrl;
            audioPlayer.play();
          }
        }
            
    }    

    var profilePicture = document.getElementById("ProfilePic");

    profilePicture.src = profile.images[0].url;


    var userName = document.getElementById("userName");
    userName.innerHTML = profile.display_name;


</script>


</body>
</html>
